<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - reflect.scentlab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-2xl mx-auto space-y-8 pb-20">
        <div class="flex justify-between items-center">
            <h1 class="text-2xl font-bold">Admin Dashboard</h1>
            <a href="/index.html" class="text-blue-500 underline">홈으로 가기</a>
        </div>

        <!-- 기본 및 연동 설정 -->
        <div class="bg-white p-6 rounded-xl shadow-sm border space-y-6">
            <h2 class="font-bold border-b pb-2">브랜드 및 시스템 설정</h2>
            <div>
                <label class="block text-xs text-gray-400 mb-1">사이트 이름</label>
                <input type="text" id="input-site-name" class="w-full p-3 border rounded-lg">
            </div>
            <div>
                <label class="block text-xs text-gray-400 mb-1">인스타그램 아이디 (예: reflect.scentlab)</label>
                <input type="text" id="input-insta-id" class="w-full p-3 border rounded-lg" placeholder="아이디만 입력">
            </div>
            <div>
                <label class="block text-xs text-gray-400 mb-1 font-bold text-blue-600">구글 시트 웹 앱 URL (신청서 연동)</label>
                <input type="text" id="input-sheet-url" class="w-full p-3 border border-blue-200 rounded-lg text-xs" placeholder="https://script.google.com/macros/s/...">
                <p class="text-[10px] text-gray-400 mt-1">* 구글 Apps Script 배포 후 받은 URL을 입력하세요.</p>
            </div>
            <div>
                <label class="block text-xs text-gray-400 mb-1">브랜드 포인트 색상</label>
                <div class="flex items-center space-x-4">
                    <input type="color" id="input-theme-color" class="w-12 h-12 border-none cursor-pointer">
                    <span id="color-code" class="font-mono text-sm">#9A8B7E</span>
                </div>
            </div>
            <button onclick="saveSettings()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-bold hover:bg-blue-600 transition-colors">모든 설정 저장하기</button>
        </div>

        <!-- 이미지 관리 -->
        <div class="bg-white p-6 rounded-xl shadow-sm border">
            <h2 class="font-bold mb-4">메인 콘텐츠 이미지</h2>
            <div id="image-list" class="space-y-6"></div>
        </div>

        <!-- 인스타그램 피드 관리 -->
        <div class="bg-white p-6 rounded-xl shadow-sm border">
            <h2 class="font-bold mb-4">인스타그램 피드 이미지 (4장)</h2>
            <div id="insta-list" class="grid grid-cols-2 gap-4"></div>
        </div>
    </div>

    <!-- 크롭 모달 -->
    <div id="crop-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-2xl max-w-xl w-full">
            <h3 class="font-bold mb-4">이미지 조율하기</h3>
            <div class="max-h-[400px] overflow-hidden mb-6"><img id="cropper-image" src=""></div>
            <div class="flex space-x-4">
                <button onclick="closeModal()" class="flex-1 py-3 border rounded-lg">취소</button>
                <button onclick="applyCrop()" class="flex-1 py-3 bg-black text-white rounded-lg">적용 및 저장</button>
            </div>
        </div>
    </div>

    <script>
        const imageConfig = [
            { key: 'hero', label: '메인 히어로 배경 (16:9)', ratio: 16/9 },
            { key: 'philosophy', label: '조향의 철학 이미지 (4:5)', ratio: 4/5 },
            { key: 'signature', label: '시그니처 퍼퓸 (3:4)', ratio: 3/4 },
            { key: 'rollon', label: '롤온 오일 (3:4)', ratio: 3/4 },
            { key: 'essence', label: '아로마 에센스 (3:4)', ratio: 3/4 }
        ];
        const instaKeys = ['insta1', 'insta2', 'insta3', 'insta4'];
        let cropper = null; let currentKey = '';

        function init() {
            // 설정 로드
            document.getElementById('input-site-name').value = localStorage.getItem('siteName') || 'reflect.scentlab';
            document.getElementById('input-insta-id').value = localStorage.getItem('instaId') || '';
            document.getElementById('input-sheet-url').value = localStorage.getItem('sheetUrl') || '';
            const color = localStorage.getItem('themeColor') || '#9A8B7E';
            document.getElementById('input-theme-color').value = color;
            document.getElementById('color-code').innerText = color;

            const savedImages = JSON.parse(localStorage.getItem('siteImages') || '{}');
            
            // 메인 이미지 리스트 생성
            const container = document.getElementById('image-list');
            imageConfig.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex items-center space-x-4 border-b pb-4 last:border-0";
                div.innerHTML = `<img src="${savedImages[item.key] || 'https://via.placeholder.com/150'}" id="prev-${item.key}" class="w-16 h-16 object-cover rounded border"><div class="flex-1"><p class="text-sm font-bold text-gray-700">${item.label}</p><input type="file" accept="image/*" onchange="openCropper('${item.key}', ${item.ratio}, event)" class="text-xs mt-2 block w-full"></div>`;
                container.appendChild(div);
            });

            // 인스타 이미지 리스트 생성
            const instaContainer = document.getElementById('insta-list');
            instaKeys.forEach(key => {
                const div = document.createElement('div');
                div.className = "border p-2 rounded-lg text-center";
                div.innerHTML = `<img src="${savedImages[key] || 'https://via.placeholder.com/150'}" id="prev-${key}" class="w-full aspect-square object-cover rounded mb-2"><input type="file" accept="image/*" onchange="openCropper('${key}', 1, event)" class="text-[10px] w-full">`;
                instaContainer.appendChild(div);
            });
        }

        function saveSettings() {
            localStorage.setItem('siteName', document.getElementById('input-site-name').value);
            localStorage.setItem('instaId', document.getElementById('input-insta-id').value);
            localStorage.setItem('sheetUrl', document.getElementById('input-sheet-url').value);
            localStorage.setItem('themeColor', document.getElementById('input-theme-color').value);
            alert('모든 설정이 저장되었습니다!');
            location.reload();
        }

        function openCropper(key, ratio, event) {
            currentKey = key;
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.getElementById('cropper-image');
                    img.src = e.target.result;
                    document.getElementById('crop-modal').classList.remove('hidden');
                    if(cropper) cropper.destroy();
                    cropper = new Cropper(img, { aspectRatio: ratio, viewMode: 1 });
                };
                reader.readAsDataURL(file);
            }
        }

        function closeModal() { document.getElementById('crop-modal').classList.add('hidden'); }

        function applyCrop() {
            const canvas = cropper.getCroppedCanvas({ width: 800 });
            const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
            const savedImages = JSON.parse(localStorage.getItem('siteImages') || '{}');
            savedImages[currentKey] = dataUrl;
            localStorage.setItem('siteImages', JSON.stringify(savedImages));
            document.getElementById(`prev-${currentKey}`).src = dataUrl;
            closeModal();
            alert('이미지가 저장되었습니다!');
        }

        init();
        document.getElementById('input-theme-color').oninput = (e) => { document.getElementById('color-code').innerText = e.target.value; };
    </script>
</body>
</html>