<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - reflect.scentlab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: sans-serif; background-color: #FDFCFB; color: #2D241E; margin: 0; }
        .font-serif { font-family: 'Noto Serif KR', serif; }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <nav class="fixed top-0 left-0 right-0 z-50 px-6 py-4 bg-[#FDFCFB] border-b border-[#E8E2DA] flex justify-between items-center">
        <a href="./index.html" id="display-site-name" class="text-2xl font-serif font-bold">reflect.scentlab</a>
        <a href="./index.html" class="text-sm uppercase tracking-widest text-[#2D241E]/70">Exit</a>
    </nav>

    <div class="min-h-screen pt-32 px-6 flex flex-col items-center max-w-2xl mx-auto pb-20">
        <div id="question-container" class="w-full text-center">
            <div class="mb-16">
                <div class="flex justify-between text-[10px] uppercase tracking-widest text-[#9A8B7E] font-bold mb-2">
                    <span id="step-indicator">Step 1 of 3</span>
                    <span id="percent-indicator">33%</span>
                </div>
                <div class="h-1 w-full bg-[#E8E2DA] rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-[#9A8B7E] transition-all duration-500" style="width: 33%"></div>
                </div>
            </div>
            <h2 id="question-text" class="text-3xl md:text-4xl font-serif mb-12 leading-snug fade-in">질문 로딩중...</h2>
            <div id="options-container" class="grid gap-4 fade-in"></div>
        </div>

        <div id="form-container" class="w-full hidden fade-in">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-serif mb-4">체험단 신청하기</h2>
                <p class="text-sm text-[#2D241E]/60 leading-relaxed">분석된 성향을 바탕으로 제작될 당신만의 향기,<br>그 첫 번째 주인공이 되어보세요.</p>
            </div>
            
            <form onsubmit="finishTest(event)" class="space-y-8">
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-xs text-gray-400 ml-1">성함 *</label>
                        <input required type="text" name="name" placeholder="성함을 입력해주세요" class="w-full p-5 bg-white border border-[#E8E2DA] rounded-2xl focus:outline-none focus:border-[#9A8B7E] text-lg">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs text-gray-400 ml-1">연락처 *</label>
                        <input required type="tel" name="phone" id="phone-input" maxlength="13" placeholder="010-0000-0000" class="w-full p-5 bg-white border border-[#E8E2DA] rounded-2xl focus:outline-none focus:border-[#9A8B7E] text-lg">
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-xs text-gray-400 ml-1">성별 *</label>
                        <select required name="gender" class="w-full p-5 bg-white border border-[#E8E2DA] rounded-2xl focus:outline-none focus:border-[#9A8B7E] text-lg appearance-none">
                            <option value="">선택해주세요</option>
                            <option value="여성">여성</option>
                            <option value="남성">남성</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs text-gray-400 ml-1">출생년도 *</label>
                        <input required type="number" name="birthYear" placeholder="YYYY (예: 1995)" class="w-full p-5 bg-white border border-[#E8E2DA] rounded-2xl focus:outline-none focus:border-[#9A8B7E] text-lg">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs text-gray-400 ml-1">현재 거주지 *</label>
                    <input required type="text" name="residence" placeholder="예: 강동구 천호동 / 잠실역 (체험 장소 조율용)" class="w-full p-5 bg-white border border-[#E8E2DA] rounded-2xl focus:outline-none focus:border-[#9A8B7E] text-lg">
                </div>

                <div class="bg-[#F9F8F6] p-6 rounded-xl text-[11px] text-gray-400 leading-relaxed border border-[#E8E2DA]/50">
                    <p class="font-bold mb-2 text-gray-500">[개인정보 수집 및 이용 동의]</p>
                    <p>1. 수집 항목: 성함, 연락처, 성별, 출생년도, 거주지</p>
                    <p>2. 수집 목적: reflect 체험단 선정 및 장소 조율, 안내 문자 발송</p>
                    <p>3. 보유 기간: 체험단 모집 종료 및 안내 완료 후 3개월 이내 파기</p>
                    <p class="mt-2">* 귀하는 동의를 거부할 권리가 있으나, 동의 거부 시 체험단 신청이 제한될 수 있습니다.</p>
                </div>

                <button type="submit" class="w-full bg-[#2D241E] text-white py-6 rounded-2xl font-bold text-lg tracking-widest uppercase hover:bg-[#9A8B7E] transition-all shadow-xl">신청 완료하기</button>
            </form>
        </div>

        <div id="finish-container" class="w-full text-center hidden fade-in">
            <div class="w-20 h-20 bg-[#9A8B7E] rounded-full flex items-center justify-center mx-auto mb-8 text-white shadow-lg"><i data-lucide="check" class="w-10 h-10"></i></div>
            <h2 class="text-3xl font-serif mb-4">신청이 완료되었습니다</h2>
            <p class="text-[#2D241E]/60 mb-10 leading-relaxed">당신만의 향기를 찾기 위한 여정에 참여해주셔서 감사합니다.</p>
            <a href="./index.html" class="bg-[#2D241E] text-white px-10 py-4 rounded-full inline-block font-bold">홈으로 돌아가기</a>
        </div>
    </div>

    <script>
        const questions = [
            { text: "당신의 피부에 닿을 첫 번째 기억은?", options: ['새벽 안개가 자욱한 숲속', '따스한 햇살이 드는 하얀 침실', '비 온 뒤 젖은 흙 내음의 정원', '벽난로가 타오르는 아늑한 서재'] },
            { text: "오늘 채우고 싶은 온도는?", options: ['차갑고 선명한 청량함', '부드럽고 포근한 온기', '차분하고 깊이 있는 무게감', '투명하고 맑은 가벼움'] },
            { text: "기억되고 싶은 실루엣은?", options: ['우아하고 세련된 도시의 밤', '순수하고 맑은 아침의 이슬', '자유롭고 대담한 야생화', '지적이고 차분한 고전의 향기'] }
        ];
        let currentStep = 0;

        // 전화번호 하이픈 자동 생성
        const phoneInput = document.getElementById('phone-input');
        if (phoneInput) {
            phoneInput.addEventListener('input', function(e) {
                let val = e.target.value.replace(/\D/g, '');
                if (val.length > 3 && val.length <= 7) {
                    val = val.slice(0, 3) + '-' + val.slice(3);
                } else if (val.length > 7) {
                    val = val.slice(0, 3) + '-' + val.slice(3, 7) + '-' + val.slice(7, 11);
                }
                e.target.value = val;
            });
        }

        function showQuestion() {
            const q = questions[currentStep];
            document.getElementById('question-text').innerText = q.text;
            const progress = ((currentStep + 1) / 4) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('step-indicator').innerText = `Step ${currentStep + 1} of 3`;
            document.getElementById('percent-indicator').innerText = Math.round(progress) + '%';
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full p-6 rounded-2xl border border-[#E8E2DA] bg-white text-left hover:border-[#9A8B7E] transition-all font-medium text-lg";
                btn.innerText = opt;
                btn.onclick = nextStep;
                container.appendChild(btn);
            });
        }

        function nextStep() {
            currentStep++;
            if(currentStep < questions.length) showQuestion();
            else {
                document.getElementById('question-container').classList.add('hidden');
                document.getElementById('form-container').classList.remove('hidden');
                document.getElementById('progress-bar').style.width = '90%';
                document.getElementById('percent-indicator').innerText = '90%';
            }
        }

        async function finishTest(e) {
            e.preventDefault();

            // 1. 관리자 설정 파일에서 구글 시트 URL 가져오기
            let sheetUrl = "";
            try {
                const response = await fetch('./data/content.json');
                const content = await response.json();
                sheetUrl = content.sheetUrl;
            } catch (err) {
                console.log("설정 로드 실패, 기본값 사용 시도");
            }

            const formData = new FormData(e.target);
            const params = new URLSearchParams(formData);

            if (sheetUrl && sheetUrl.startsWith("http")) {
                try { 
                    fetch(sheetUrl, { 
                        method: 'POST', 
                        mode: 'no-cors', 
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: params 
                    }); 
                } 
                catch (err) { console.error('전송 에러:', err); }
            }

            document.getElementById('form-container').classList.add('hidden');
            document.getElementById('finish-container').classList.remove('hidden');
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('percent-indicator').innerText = '100%';
            lucide.createIcons();
        }

        window.onload = function() {
            showQuestion();
            lucide.createIcons();
        };
    </script>
</body>
</html>
